---
title: "DAIME"
author: "Niklas Hohmann"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{DAIME}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width=4,
  fig.height=4 
)
```
This document provides a brief introduction into the structure of the R package DAIME with an overview of the available functions and some explanations regarding their options.

## Introduction
Changing deposition rates determine how much time it takes to deposit a given thickness of sediment. This determines how diluted or condensed the information contained in this sediment is, and accordingly alters the perception of time and speed when working with the rock record.

The DAIME package allows to

1. Model how changing deposition rates and hiatuses alter the stratigraphic expression of temporal patterns

2. Express data derived from the sedimentary rock record in terms of time

## Available Functions
The 2.11 version of the package contains the following core functions:

1. `pointtransform` to transform the location of individual points from time into stratigraphic height and vice versa. This can also be used to create age models from deposition rates and transform isotope ratios between time and height

2. `patterntransform` to transform patterns from time into stratigraphic height and vice versa. A pattern can be any grain-based input into the sediment (e.g. fossil occurrences, some geochemical proxies) and rates derived from it (e.g. rate of morphological change or first/last fossil occurrences, both derived from fossil occurrences)

It further contains the following supplementary function:

3. `patterntodepositionmodel` to construct a deposition model based on the sedimentary condensation/dilution of a known pattern

In addition to that, the following functions are available for backwards compatibility:

* `strattotimepointbin`, `strattotimepointcont`, `timetostratpointbin`, and`timetostratpointcont` as wrappers of `pointtransform`

* `strattotimeratebin`, `strattotimeratecont`, `timetostratratebin`, and `timetostratratecont` as wrappers of `patterntransform`

## Transformable Data
### Points
Data consisting of individual points can be transformed via the function `pointtransform`. These points can be

* Locations of samples or arbitrary objects found in the sediment (will be transformed into their time of deposition)

* Time of deposition of any object contained in the sediment (will be transformed into the stratigraphic height where it can be found).

#### Samples associated with measurements
Samples are often associated with measurements performed on this sample (e.g. Hg content measured on a bivalve). For such samples, only their location needs to be transformed via the DAIME model, the measured values remain unchanged and associated with the sample.

#### Isotope Ratios, Ratios in General and Percentages
In (isotope) ratios, percentages, and ratios in general, values of the numerator and denominator are condensed and diluted equally. This cancels out the effects of sedimentary condensation/dilution on the value (ordinate). However the locations where these values were measured (abscissa) are still affected by condensation/dilution.
To account for this, the locations where the ratios were determined need to be transformed via `pointtransform` whilst keeping the values associated with these locations unchanged. For an example, see the help page of `pointtransform`.

### Patterns (Rates)
Patterns can be transformed using the function `patterntransform`. Patterns can be taken as synonymous with rates, and can be subdivided into

* Temporal rates: Any input into the sediment per time unit

* Stratigraphic rates: Any content in the sediment per stratigraphic height

This can for example be

* Fossil rates (e.g. fossil found per meter or shells deposited per year)

* First / last fossil occurrences (but see below)

* Rates of proxies (e.g. Th content per meter/ Th input per time unit)

but also information derived from these rates such as

* Rates of morphological evolution (derived from fossils)

#### First and Last fossil occurrences
First and last occurrences are defined post hoc in the section. Due to this they cannot be transformed as a pattern when Hiatuses are present (with no hiatuses around, they can be transformed as any other pattern).

In the presence of hiatuses, simulation approaches or estimates to bracket their position should be used.

### Relation between points and patterns
The relation between patterns and points is similar to the relation between a distribution and a sample. One is the abstract description (pattern) while one is the realization (point)

## Deposition models
Deposition models are central to the DAIME package and describe how sediment input into the system changes through time. There are three ways to hand a deposition model over to the functions `pointtransform` and `patterntransform`:

* as age model

* as piecewise linear deposition rate

*  as binned deposition rate.

By default, the deposition model is assumed to be a piecewise linear deposition rate. This can be adjusted using the `depositionmodel` option.

### Age models
Age models assign (1) a stratigraphic height its time of deposition and (equivalently) an age the stratigraphic height that was deposited at said age. Age models are described by two vectors of equal length, here named `agemodelage` and `agemodelheight`. The entry `agemodelage[i]` is the age of the sediment at the stratigraphic height `agemodelheight[i]` and vice versa.

```{r fig1}

par(mar=c(4,4,1,0),mgp=c(2.1,0.4,0))
agemodelage=seq(0,3,length.out = 100)
agemodelheight=splinefunH(x=c(0,1,3),y=c(0,0.8,2),m=c(0.2,2,0.3))(agemodelage)
plot(agemodelage,agemodelheight,type='l',xlab='Time/Age \n ( agemodelage )',ylab='Stratigraphic Height \n ( agemodelheight )',main='Age Model',lwd=4)
```

WHen the transformation is from height to time, i.e. the functions are used with `direction` in the setting `height to time`, `agemodelheight` corresponds to `xdep` and `agemodelage` corresponds to `ydep`.

When `direction` is set to `time to height`, `agemodelage` corresponds to `xdep`and `agemodelheight` corresponds to `ydep`. 

### Deposition Rates
Deposition rates describe the sediment input into a system through time. They can be handed over either as piecewise linear deposition rate by setting `depositionmodel` to `piecewise linear deposition rate` or as binned deposition rate by setting `depositionmodel` to `binned deposition rate`.

#### Piecewise linear deposition rates
For piecewise linear deposition rates, the deposition rate is given by `depositionrate=approxfun(xdep,ydep)`. Accordingly `xdep` and `ydep` need to be of the same size.

#### Binned depositon rates
For binned deposition rates, the values of the deposition rate between `xdep[i]` and `xdep[i+1]` is given by `ydep[i]`. Accordingly `ydep` is one entry shorter than `xdep`

#### Inverse deposition rates and units
For the transformation from height to time, the additional option `unit`is available. This is since deposition rates in the section can be described in two ways:

1. Either they give a description of the deposition rates with which the heights in the section were deposited

2. Or they describe how much time is "contained" in sediment ("inverse" deposition rate).

Setting `unit` to `sediment per time` and the functions will interpret the deposition rate described by `xdep` and `ydep` in the first way. Setting is to `time per sediment` will lead to the functions interpreting the deposition rates in the second way.

The default setting is `unit='sediment per time'`. For the effects of this options see the examples given in the help pages of `pointtransform` and `patterntransform`.

### Creating age models from the condensation/dilution of patterns
The function `patterntodepositionmodel` creates an age model that condenses/dilutes a given temporal pattern into a given stratigraphic pattern and vice versa. For examples see its help page.

### Hiatuses, Erosion, and Nondeposition
The handling of hiatuses, erosion, and nondeposition depends on the direction of transformation.

For the transformation from section to time, i.e. using the option `direction="height to time"`, hiatuses can be inserted at any stratigraphic height using the `hiatuslist` option. For details see the corresponding help pages.

For the transformation from time to the section, i.e. using the option `direction="time to height"`, hiatuses, erosion, and nondeposition can be modeled via deposition rates that are zero (nondeposition) or negative (erosion) or as time intervals where the age model is decreasing.

Hiatuses are destructive in this implementation of the DAIME model. Anything being deposited right at a hiatus or during an interval of nondeposition or erosion will be destroyed by the transformation.

## Examples
For examples please refer to the help pages of the corresponding functions
